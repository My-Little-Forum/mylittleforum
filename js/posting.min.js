function BBCodeButton(a){if(a){var b=null,c=this,d=null;this.canInsert=function(){return b&&b.getTextArea()},this.getCode=function(){return d.name},this.getButtonGroup=function(){return b},this.addButtonGroup=function(a){b=a},this.insertCode=function(){if(this.canInsert()){var a=b.getTextArea(),c=a.getSelection();a.insertTextRange("["+this.getCode()+"]"+c+"[/"+this.getCode()+"]")}},this.setHTMLElement=function(a){d=a,d.onclick=function(){return c.insertCode(this),!1}},this.getHTMLElement=function(){return d},this.setHTMLElement(a)}}function BBCodeLinkButton(a){this.constructor(a);var b=new RegExp(/[http|https|ftp|ftps]:\/\/[a-zA-Z0-9-.][a-zA-Z0-9-.]+(S+)?/);this.insertCode=function(){if(this.canInsert()){var a=this.getButtonGroup();window.setTimeout(function(){var c=a.getTextArea(),d=c.getSelection().trim(),e=b.test(d)?window.prompt(lang.bbcode_link_url,d):window.prompt(lang.bbcode_link_url,"https://");e&&""!=e&&"https://"!=e&&"http://"!=e&&"ftp://"!=e&&"ftps://"!=e&&((""==d||b.test(d))&&(d=window.prompt(lang.bbcode_link_text,"")),null!=d&&(""==d?c.insertTextRange("[link]"+e+"[/link]"):c.insertTextRange("[link="+e+"]"+d+"[/link]")))},150)}}}function BBCodePromtButton(a,b,c){this.constructor(a),c=c||"",this.insertCode=function(){if(this.canInsert()){var a=this.getButtonGroup(),d=this.getCode();window.setTimeout(function(){var e=a.getTextArea(),f=e.getSelection().trim();if(""==f){var g=window.prompt(b,c);g&&""!=g.trim()&&g.trim()!=c&&e.insertTextRange("["+d+"]"+g+"[/"+d+"]")}else e.insertTextRange("["+d+"]"+f+"[/"+d+"]")},150)}}}function BBCodeColorChooserButton(a){this.constructor(a);for(var b,c=["#fff","#ccc","#c0c0c0","#999","#666","#333","#000","#fcc","#f66","#f00","#c00","#900","#600","#300","#fc9","#f96","#f90","#f60","#c60","#930","#630","#ff9","#ff6","#fc6","#fc3","#c93","#963","#633","#ffc","#ff3","#ff0","#fc0","#990","#660","#330","#9f9","#6f9","#3f3","#3c0","#090","#060","#030","#9ff","#3ff","#6cc","#0cc","#399","#366","#033","#cff","#6ff","#3cf","#36f","#33f","#009","#006","#ccf","#99f","#66c","#63f","#60c","#339","#309","#fcf","#f9f","#c6c","#c3c","#939","#636","#303"],d=document.createElement("table"),e=document.createElementWithAttributes("tbody",{},d),f=this,g=document.createElementWithAttributes("tr",{},e),h=0;h<c.length;h++){b=document.createElementWithAttributes("td",{},g),b.style.backgroundColor=c[h],b.style.width="15px",b.style.height="15px",b.style.fontSize="15px";var j=document.createElementWithAttributes("a",{href:"#",extension:"="+c[h],onclick:function(){return f.insertOptionCode(this),!1}},b);j.classList.add("js-display-block"),j.appendChild(document.createTextNode(String.fromCharCode(160))),0==(h+1)%7&&(g=document.createElementWithAttributes("tr",{},e))}this.insertOptionCode=function(a){if(this.canInsert()){var b=this.getButtonGroup(),c=b.getTextArea(),d=this.getCode();c.insertTextRange("["+d+a.extension+"]"+c.getSelection()+"[/"+d+"]"),b.getAdditionalOptionsWindow().enableOptionList(!1)}},this.insertCode=function(a){if(this.canInsert()){var b=this.getButtonGroup(),c=document.getElementPoSi(a);b.getAdditionalOptionsWindow().setOptionList(d),b.getAdditionalOptionsWindow().enableOptionList(!0,c)}}}function BBCodeOptionButton(a,b,c,d){if(this.constructor(a),!!b){c=c||!1,d=d||"";for(var e=document.createElement("ul"),f=this,g=0;g<b.length;g++){var h=b[g],j=document.createElementWithAttributes("li",{},e),k=document.createElementWithAttributes("a",{href:"#",attribute:h.attribute,onclick:function(){return f.insertOptionCode(this),!1}},j);k.appendChild(document.createTextNode(h.label)),e.appendChild(j)}this.insertOptionCode=function(a){if(this.canInsert()){var b=this.getButtonGroup(),e=this.getCode(),f=this.getCode();window.setTimeout(function(){var g=b.getTextArea(),h=g.getSelection();if(null!=a.attribute&&""!=a.attribute.trim()&&("inlinecode"==a.attribute.trim().toLowerCase()?e=f=a.attribute:a.attribute.includes("=")?e+=" "+a.attribute:e+="="+a.attribute),c&&""==h){var i=window.prompt(c,d);i&&""!=i.trim()&&i.trim()!=d&&g.insertTextRange("["+e+"]"+i+"[/"+f+"]")}else g.insertTextRange("["+e+"]"+h+"[/"+f+"]");b.getAdditionalOptionsWindow().enableOptionList(!1)},150)}},this.insertCode=function(a){if(this.canInsert()){var b=this.getButtonGroup(),c=document.getElementPoSi(a);b.getAdditionalOptionsWindow().setOptionList(e),b.getAdditionalOptionsWindow().enableOptionList(!0,c)}}}}function BBCodeListButton(a){this.constructor(a),this.insertCode=function(){if(this.canInsert()){for(var a=this.getButtonGroup(),b=a.getTextArea(),c=b.getSelection(),d="",e=c.split(/(\n|\r|\r\n)+/),f=0;f<e.length;f++)""!=e[f].trim()&&(d+="\r\n[*]"+e[f]);""==d.trim()&&(d="\r\n[*]...\r\n[*]...\r\n[*]..."),b.insertTextRange("\r\n[list]"+d+"\r\n[/list]\r\n")}}}function BBCodeSingleSmilieButton(a){this.constructor(a),this.insertCode=function(){if(this.canInsert()){var a=this.getButtonGroup(),b=a.getTextArea(),c=b.getSelection();b.insertTextRange(c+this.getCode()+" ")}}}function BBCodeSmilieButton(a,b){this.constructor(a,b);for(var c=this,d=document.createElementWithAttributes("ul",{id:"additional-smilies"},null),e=0;e<b.length;e++){let a=document.createElementWithAttributes("li",{},d),f=document.createElementWithAttributes("button",{type:"button",title:b[e].title,value:b[e].code,onclick:function(){return c.insertButtonCode(this),!1}},a);f.appendChild(b[e].label)}this.insertButtonCode=function(){if(this.canInsert()){var a=this.getButtonGroup(),b=a.getTextArea();const c=event.target.closest("button").getAttribute("value");b.insertTextRange(b.getSelection()+c+" "),a.getAdditionalOptionsWindow().enableOptionList(!1)}},this.insertCode=function(a){if(this.canInsert()){var b=this.getButtonGroup(),c=document.getElementPoSi(a);b.getAdditionalOptionsWindow().setOptionList(d),b.getAdditionalOptionsWindow().enableOptionList(!0,c)}}}function BBCodePopUpButton(a,b,c,d){this.constructor(a),c="number"==typeof c?c:350,d="number"==typeof d?d:350;var e=(screen.width-c)/2,f=(screen.height-d)/4;this.insertCode=function(){if(this.canInsert()){var a=window.open(b,"MyLittleForum","height="+d+",width="+c+",left="+e+", top="+f+",scrollbars,resizable");window.mlfBBCodeButton=this,a.focus()}}}BBCodeLinkButton.prototype=new BBCodeButton,BBCodeSmilieButton.prototype=new BBCodeButton,BBCodeSingleSmilieButton.prototype=new BBCodeButton,BBCodeColorChooserButton.prototype=new BBCodeButton,BBCodeOptionButton.prototype=new BBCodeButton,BBCodeListButton.prototype=new BBCodeButton,BBCodePopUpButton.prototype=new BBCodeButton,BBCodePromtButton.prototype=new BBCodeButton;function ButtonGroup(a){if(a){var b=a.elements.text;b||(b=document.createElementWithAttributes("textarea",{name:"text",id:"text",cols:80,rows:20},a));var c=!1,d=[],e=null,f=this;a.onsubmit=function(){var b="";return(a.elements.name_required&&a.elements.name&&""==a.elements.name.value.trim()&&(b+="- "+lang.error_no_name+"\n"),a.elements.subject&&""==a.elements.subject.value.trim()&&(b+="- "+lang.error_no_subject+"\n"),a.elements.text_required&&a.elements.text&&""==a.elements.text.value.trim()&&(b+="- "+lang.error_no_text+"\n"),a.elements.terms_of_use_required&&a.elements.terms_of_use_agree&&!1==a.elements.terms_of_use_agree.checked&&(b+="- "+lang.terms_of_use_error_posting+"\n"),b)?(window.alert(b),!1):(document.getElementById("throbber-submit")&&document.getElementById("throbber-submit").removeAttribute("hidden"),!0)};var g=function(){if(document.getElementById("smiley-bar")){var a=document.getElementById("smiley-bar");if(document.getElementById("smiley-instructions")){let d=document.getElementById("smiley-instructions").querySelectorAll("div");var b=null,c=[];for(const e of d){const d=e.querySelector("dt"),f=e.querySelectorAll("dd");if(d&&(b={code:d.textContent,title:d.getAttribute("title"),classes:d.getAttribute("class"),isSmilie:!0,childs:[]}),b&&f)for(const e of f)b.label=e.firstChild,-1==b.classes.search(/default/)?c.push(b):l(b,a),b=null}0<c.length&&(b={code:"",title:lang.more_smilies_title,label:lang.more_smilies_label,classes:"",isSmilie:!0,childs:c},b&&l(b,a))}}},h=function(){if(document.getElementById("bbcode-bar")){var a=document.getElementById("bbcode-bar");if(document.getElementById("bbcode-instructions")){let d=document.getElementById("bbcode-instructions").querySelectorAll("div");var b=null;for(const e of d){const d=e.querySelector("dt"),f=e.querySelectorAll("dd");if(d&&(b={code:d.getAttribute("id"),label:d.getAttribute("title"),title:d.textContent,classes:d.getAttribute("class"),iconfile:d.getAttribute("data-icon"),childs:[]}),b&&f)for(const a of f){var c={attribute:a.getAttribute("id"),label:a.getAttribute("title")};b.childs.push(c)}b&&l(b,a)}}}},k=function(a,b){if(b=b||!1,a instanceof BBCodeButton)if(a.addButtonGroup(f),b||!c)d[a.getCode()]=a;else if(d[a.getCode()]){var e=d[a.getCode()].getHTMLElement(),g=a.getHTMLElement();a.setHTMLElement(e),g.parentNode.removeChild(g),d[a.getCode()]=a}else if(!b&&c){var h=a.getHTMLElement();h.parentNode.removeChild(h)}},l=function(a,c){var d={className:a.classes,name:a.code,type:"button",title:a.title,tabIndex:-1},e=""==a.code.trim()?"bbcodebutton":"bbcodebutton-"+a.code;a.isSmilie?d.isSmilie=a.isSmilie:d.id=e;var f=document.createElementWithAttributes("button",d,c);if(void 0!==a.iconfile&&0<a.iconfile.length){const b=document.querySelector("link[rel=\"stylesheet\"]"),c=b.href.substring(0,b.href.lastIndexOf("/")+1),d=document.createElementWithAttributes("img",{className:"icon",src:c+"images/"+a.iconfile,alt:"",width:"14",height:"14"});f.appendChild(d)}var b=document.createElement("span");"string"==typeof a.label?b.appendChild(document.createTextNode(a.label)):b.appendChild(a.label),f.appendChild(b),k(m(f,a.childs))},m=function(a,b){var c=null,d=a&&a.name?a.name.toLowerCase():"";return c="link"===d?new BBCodeLinkButton(a):"media"===d?b&&1<b.length?new BBCodeOptionButton(a,b,lang.bbcode_media_url,"https://"):new BBCodePromtButton(a,lang.bbcode_media_url,"https://"):"img"===d?b&&1<b.length?new BBCodeOptionButton(a,b,lang.bbcode_image_url,"https://"):new BBCodePromtButton(a,lang.bbcode_image_url,"https://"):"color"===d?new BBCodeColorChooserButton(a):"list"===d?new BBCodeListButton(a):"upload"===d?new BBCodePopUpButton(a,"index.php?mode=upload_image",settings.upload_popup_width,settings.upload_popup_height):"tex"===d?new BBCodePromtButton(a,lang.bbcode_tex_code):a.isSmilie&&b&&0<b.length?new BBCodeSmilieButton(a,b):a.isSmilie?new BBCodeSingleSmilieButton(a):b&&1<b.length?new BBCodeOptionButton(a,b):new BBCodeButton(a),c},n=function(){var a=document.createElementWithAttributes("div",{id:"bbcode-options"},document.body),b=document.createElementWithAttributes("div",{},a);a.classList.add("js-display-none");var c=null;a.onmouseover=function(){c&&window.clearTimeout(c)},a.onmouseout=function(a){a=a||window.event;var b=a.relatedTarget||a.toElement||!1,d=this;return this.contains(b)||(c=window.setTimeout(function(){d.enableOptionList(!1)},125)),!1},a.setOptionList=function(a){b.firstChild?b.replaceChild(a,b.firstChild):b.appendChild(a)},a.enableOptionList=function(a,b){b&&(this.style.left=b.left+"px",this.style.top=b.top+"px"),a?this.classList.remove("js-display-none"):this.classList.add("js-display-none")};var d=window.document.onmousedown;return window.document.onkeypress=function(a){"Esc"==a.key&&f.enableOptionList(!1),"function"==typeof d&&d(a)},a},o=function(a){a=a||!1,c=!1;var b=a?"smiley-bar":"bbcode-bar";if(document.getElementById(b)){var d=document.getElementById(b).getElementsByTagName("button");if(d&&0<d.length)for(var e=d.length,f=0;f<e;f++)c=!0,d[f].isSmilie=a,k(m(d[f],null),!0)}},p=function(){if(b.quote="",document.getElementById("quote")&&"true"==document.getElementById("quote").value&&(b.quote=b.value,b.value=""),b.getQuote=function(){return b.quote.trim()},""!=b.getQuote()&&document.getElementById("message")){var a=document.querySelector("label[for=\"text\"]");if(a){var c=document.createElementWithAttributes("button",{type:"button",id:"insert-quote",title:lang.quote_title,tabIndex:-1});c.onclick=function(){return b.value=b.getQuote()+"\r\n\r\n"+b.value,this.classList.add("js-display-none"),b.focus(),!1},c.appendChild(document.createTextNode(lang.quote_label)),a.parentNode.insertBefore(c,a.nextSibling)}}b.getSelection=function(){return this.focus(),"number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd?this.value.substring(this.selectionStart,this.selectionEnd):document.selection&&document.selection.createRange?document.selection.createRange().text:""},b.insertTextRange=function(a){if(this.focus(),"undefined"!=typeof this.selectionStart){var b=this.scrollTop,c=this.value.substring(0,this.selectionStart),d=this.value.substring(this.selectionEnd,this.textLength);this.value=c+a+d,this.selectionStart=c.length,this.selectionEnd=c.length+a.length,this.scrollTop=b,this.focus()}else if(document.selection&&document.selection.createRange){var e=document.selection.createRange();e.text=a,e.select()}else this.value+=a}};this.getTextArea=function(){return b},this.getAdditionalOptionsWindow=function(){return e};var q=function(){var b=null;if(b=document.getElementById("delete_cookie")){var c=document.getFirstChildByElement(b,"a");c.onclick=function(){return document.cookie=settings.session_prefix+"userdata=; expires=Thu, 01-Jan-70 00:00:01 GMT;",b.innerHTML="",a.elements.setcookie&&(a.elements.setcookie.checked=!1),!1}}},r=function(){if(document.getElementById("formatting-help")){var a=document.getElementById("formatting-help");a.classList.add("js-display-none")}};(function(){e=n(),p(),o(!1),h(),o(!0),g(),q(),r()})()}}document.addEventListener("DOMContentLoaded",function(){"object"==typeof settings&&"object"==typeof lang&&new ButtonGroup(document.getElementById("postingform"))});